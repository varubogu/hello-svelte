# 仕様

## 概要

サーバー側、クライアント側それぞれ異なる理由でキャッシュが必要。
それぞれ地域ごとにキャッシュし、さらにデータが3時間単位なので、3時間ごとにキャッシュを更新する。


## サーバー側のキャッシュ

今回使用する天気情報APIキーは流出してはいけない情報のため、サーバー側に隠蔽してクライアントからはアクセスできないようにしておく。


### サーバー側のキャッシュの流れ

1. クライアントからフロントエンドサーバーへAPIリクエストをする。
2. フロントエンドサーバーはサーバー側のKVストアに対象の天気情報があるか確認する。
3. サーバー側のKVストアに対象の天気情報があれば、そのデータを返す。
4. サーバー側のKVストアに対象の天気情報がなければ、天気情報を取得してキャッシュ、サーバーのKVストアに保存する。
5. サーバー側のKVストアに保存されている天気情報を返す。


## クライアント側のキャッシュ

基本的な考え方として、天気APIは直接叩かず、フロントエンドサーバーにリクエストを投げる。

### クライアント側のキャッシュの流れ

1. クライアント側のキャッシュに保存されている天気情報があるか確認する。
2. クライアント側のキャッシュに保存されている天気情報があれば、そのデータを返す。
3. クライアント側のキャッシュに保存されている天気情報がなければ、フロントエンドサーバーにリクエストを投げる。
4. サーバー側のKVストアに保存されている天気情報を返す。
5. クライアント側のキャッシュに保存されている天気情報を返す。

## データ構成

- cache キャッシュ情報
  - weathers 天気情報のキャッシュ
    - [ariaCode] 地域情報のキャッシュ ※Tokyo、Hyogo、Oita、Hokkaidoなど
      - data 天気情報のデータ（JSON）
      - updatedAt データの更新日時
      - expiresAt データの有効期限

